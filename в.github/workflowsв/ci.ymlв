name: CI

on:
  push:
    branches: [main, master]
  pull_request:

env:
  PYTHON_VERSION: "3.10"
  TOKEN: "dummy-token"       # real токен хранится в secrets, здесь только для статических импортов
  ADMIN_ID: "0"

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install root requirements (site)
        run: |
          if [ -f requirements.txt ]; then
            python -m pip install --upgrade pip
            python -m pip install -r requirements.txt
          fi

      - name: Install bot requirements
        run: |
          if [ -f mybot/requirements.txt ]; then
            python -m pip install -r mybot/requirements.txt
          fi

      - name: Smoke imports
        env:
          TOKEN: ${{ secrets.TOKEN || env.TOKEN }}
          ADMIN_ID: ${{ secrets.ADMIN_ID || env.ADMIN_ID }}
        run: |
          python - <<'PY'
          import flask_app
          import mybot.config
          # не запускаем бота, только проверяем, что импортируются модули
          print("Smoke imports OK")
          PY

